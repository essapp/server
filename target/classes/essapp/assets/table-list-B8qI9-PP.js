import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-BWFQ7fUJ.js";import{x as ge,y as ve,u as ke}from"./index-C5Ppdpc0.js";import{bl as ye,bm as xe,al as be,O as Ce,bn as we,E as he,b9 as T,a2 as Ie,a3 as Se,ah as Ae,bd as ze,aa as Oe,v as Ue,w as Ne,as as Le,J as De,S as Me,X as Ve,ag as $e,u as Be,M as Re,D as Pe,a5 as je,bo as Ee,au as He,an as Je}from"./antd-CGu55NZb.js";import{d as Te,s as M,r as V,f,c as F,w as Fe,o as Ge,a2 as m,a9 as S,aa as a,k as t,u as n,G as i,ae as $,ad as G,H as B,a3 as K,a4 as Ke}from"./vue-1GTWcegU.js";import"./context-srHhasJW.js";async function Qe(w){return ge("/list/consult-list",w)}async function Xe(w){return ve(`/list/${w}`)}const qe={key:0,flex:"","gap-2":""},We=["onClick"],Ye={key:1,"gap-2":""},ot=Te({__name:"table-list",setup(w){const Q={0:"关闭",1:"运行中",2:"上线",3:"错误"},R=ke(),A=M([{title:"#",dataIndex:"id"},{title:"规则名称",dataIndex:"name"},{title:"描述",dataIndex:"desc"},{title:"服务调用次数",dataIndex:"callNo"},{title:"状态",dataIndex:"status",width:100},{title:"上次调度时间",dataIndex:"updatedAt",width:200},{title:"操作",dataIndex:"action",width:200}]),r=M(!1),c=V({pageSize:10,pageSizeOptions:["10","20","30","40"],current:1,total:100,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`总数据位：${o}`,onChange(o,e){c.pageSize=e,c.current=o,k()}}),P=M([]),s=V({name:void 0,callNo:void 0,desc:void 0,status:void 0,updatedAt:void 0}),g=f(["large"]),X=f([{key:"large",label:"默认",title:"默认"},{key:"middle",label:"中等",title:"中等"},{key:"small",label:"紧凑",title:"紧凑"}]),v=f(!1),q=F(()=>A.value.map(o=>o.dataIndex==="action"?{label:o.title,value:o.dataIndex,disabled:!0}:{label:o.title,value:o.dataIndex})),z=f(!1),d=F(()=>A.value.map(o=>o.dataIndex)),u=V({indeterminate:!1,checkAll:!0,checkList:d.value});async function k(){if(!r.value){r.value=!0;try{const{data:o}=await Qe({...s,current:c.current,pageSize:c.pageSize});P.value=o??[]}catch(o){console.log(o)}finally{r.value=!1}}}async function O(){c.current=1,await k()}async function W(){s.name=void 0,s.desc=void 0,await k()}async function Y(o){const e=R.loading("删除中......");try{(await Xe(o.id)).code===200&&await k(),R.success("删除成功")}catch(_){console.log(_)}finally{e()}}function Z(){v.value=!1,T.destroyAll(),O()}const ee=o=>{g.value[0]=o.key};function h(o){return A.value.filter(e=>!!o.includes(e.dataIndex))}const y=f(h(d.value));function te(o){Object.assign(u,{checkList:o.target.checked?d.value:[],indeterminate:!0}),y.value=o.target.checked?h(d.value):y.value.filter(e=>e.dataIndex==="action")}Fe(()=>u.checkList,o=>{u.indeterminate=!!o.length&&o.length<d.value.length,u.checkAll=o.length===d.value.length});function ae(){u.checkList=d.value,y.value=h(d.value)}function ne(o){const e=h(o);y.value=e}Ge(()=>{k()});const x=f(!1);return(o,e)=>{const _=Ie,b=Se,p=Ae,le=ze,U=Oe,I=Ue,oe=Ne,se=Le,C=De,N=Me,ue=Ve,L=$e,D=Be,ie=Re,j=Pe,de=je,re=Ee,ce=He,_e=Je,pe=T,fe=me;return m(),S(fe,null,{default:a(()=>[t(L,{"mb-4":""},{default:a(()=>[t(ue,{"label-col":{span:7},model:n(s)},{default:a(()=>[t(U,{gutter:[15,0]},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(b,{name:"name",label:"规则名称"},{default:a(()=>[t(_,{value:n(s).name,"onUpdate:value":e[0]||(e[0]=l=>n(s).name=l)},null,8,["value"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(b,{name:"desc",label:"描述"},{default:a(()=>[t(_,{value:n(s).desc,"onUpdate:value":e[1]||(e[1]=l=>n(s).desc=l)},null,8,["value"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(b,{name:"updatedAt",label:"上次调用时间"},{default:a(()=>[t(le,{value:n(s).updatedAt,"onUpdate:value":e[2]||(e[2]=l=>n(s).updatedAt=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),n(x)?(m(),S(U,{key:0,gutter:[15,0]},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(b,{name:"status",label:"状态"},{default:a(()=>[t(oe,{value:n(s).status,"onUpdate:value":e[3]||(e[3]=l=>n(s).status=l)},{default:a(()=>[t(I,{value:"0"},{default:a(()=>e[12]||(e[12]=[i(" 关闭 ")])),_:1}),t(I,{value:"1"},{default:a(()=>e[13]||(e[13]=[i(" 运行中 ")])),_:1}),t(I,{value:"2"},{default:a(()=>e[14]||(e[14]=[i(" 上线 ")])),_:1}),t(I,{value:"3"},{default:a(()=>e[15]||(e[15]=[i(" 错误 ")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(b,{name:"callNo",label:"服务调用次数"},{default:a(()=>[t(se,{value:n(s).callNo,"onUpdate:value":e[4]||(e[4]=l=>n(s).callNo=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})):$("",!0),t(U,{span:24,style:{"text-align":"right"}},{default:a(()=>[t(p,{span:24},{default:a(()=>[t(N,{flex:"","justify-end":"","w-full":""},{default:a(()=>[t(C,{loading:n(r),type:"primary",onClick:O},{default:a(()=>e[16]||(e[16]=[i(" 查询 ")])),_:1},8,["loading"]),t(C,{loading:n(r),onClick:W},{default:a(()=>e[17]||(e[17]=[i(" 重置 ")])),_:1},8,["loading"]),t(C,{type:"link",onClick:e[5]||(e[5]=l=>x.value=!n(x))},{default:a(()=>[i(G(n(x)?"收起":"展开")+" ",1),n(x)?(m(),S(n(ye),{key:0})):(m(),S(n(xe),{key:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{title:"查询表格"},{extra:a(()=>[t(N,{size:"middle"},{default:a(()=>[t(C,{type:"primary",onClick:e[6]||(e[6]=()=>v.value=!0)},{icon:a(()=>[t(n(be))]),default:a(()=>[e[18]||(e[18]=i(" 新增 "))]),_:1}),t(D,{title:"刷新"},{default:a(()=>[t(n(Ce),{onClick:O})]),_:1}),t(D,{title:"密度"},{default:a(()=>[t(j,{trigger:"click"},{overlay:a(()=>[t(ie,{"selected-keys":n(g),"onUpdate:selectedKeys":e[7]||(e[7]=l=>B(g)?g.value=l:null),items:n(X),onClick:ee},null,8,["selected-keys","items"])]),default:a(()=>[t(n(we))]),_:1})]),_:1}),t(D,{title:"列设置"},{default:a(()=>[t(j,{open:n(z),"onUpdate:open":e[10]||(e[10]=l=>B(z)?z.value=l:null),trigger:"click"},{overlay:a(()=>[t(L,null,{title:a(()=>[t(de,{checked:n(u).checkAll,"onUpdate:checked":e[8]||(e[8]=l=>n(u).checkAll=l),indeterminate:n(u).indeterminate,onChange:te},{default:a(()=>e[19]||(e[19]=[i(" 列选择 ")])),_:1},8,["checked","indeterminate"])]),extra:a(()=>[t(C,{type:"link",onClick:ae},{default:a(()=>e[20]||(e[20]=[i(" 重置 ")])),_:1})]),default:a(()=>[t(re,{value:n(u).checkList,"onUpdate:value":e[9]||(e[9]=l=>n(u).checkList=l),options:n(q),style:{display:"flex","flex-direction":"column"},onChange:ne},null,8,["value","options"])]),_:1})]),default:a(()=>[t(n(he))]),_:1},8,["open"])]),_:1})]),_:1})]),default:a(()=>[t(ce,{loading:n(r),columns:n(y),"data-source":n(P),pagination:n(c),size:n(g)[0]},{bodyCell:a(l=>{var E,H,J;return[((E=l==null?void 0:l.column)==null?void 0:E.dataIndex)==="action"?(m(),K("div",qe,[Ke("a",{"c-error":"",onClick:Ze=>Y(l==null?void 0:l.record)}," 删除 ",8,We)])):$("",!0),((H=l==null?void 0:l.column)==null?void 0:H.dataIndex)==="status"?(m(),K("div",Ye,G(Q[(J=l==null?void 0:l.record)==null?void 0:J.status]),1)):$("",!0)]}),_:1},8,["loading","columns","data-source","pagination","size"])]),_:1}),t(pe,{open:n(v),"onUpdate:open":e[11]||(e[11]=l=>B(v)?v.value=l:null),title:"新建规则",width:"400px",onOk:Z},{default:a(()=>[t(N,{direction:"vertical",size:"large",class:"w-full"},{default:a(()=>[t(_,{placeholder:"请输入"}),t(_e,{placeholder:"请输入"})]),_:1})]),_:1},8,["open"])]),_:1})}}});export{ot as default};
